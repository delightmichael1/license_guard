{"version":3,"sources":["../src/Maintenance.tsx","../src/utils/constants.ts","../src/utils/api.ts","../src/utils/cookies.ts","../src/AppValidator.tsx"],"names":["jsx"],"mappings":"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","file":"index.mjs","sourcesContent":["interface MaintenanceProps {\n  appName?: string;\n  message?: string;\n}\n\nexport default function Maintenance({ appName, message }: MaintenanceProps) {\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        height: \"100vh\",\n        textAlign: \"center\",\n        background: \"#f3f4f6\",\n        fontFamily: \"sans-serif\",\n        padding: \"20px\",\n      }}\n    >\n      <h1>\n        {appName ||\n          (typeof document !== \"undefined\" ? document.title : \"Application\")}\n      </h1>\n      <h2>Currently under maintenance</h2>\n      {message && <p>{message}</p>}\n    </div>\n  );\n}\n","export const OFFLINE_GRACE_PERIOD = 1000 * 60 * 60 * 24;\nexport const DEFAULT_API_ENDPOINT = \"http://localhost:8000/v1/app/validate\";\n","import { DEFAULT_API_ENDPOINT } from \"./constants\";\n\nexport interface ValidationResponse {\n  status: \"OK\" | \"MAINTENANCE\";\n  message?: string;\n}\n\nexport async function validateApp(\n  appId: string,\n  apiEndpoint?: string,\n): Promise<ValidationResponse> {\n  const endpoint = apiEndpoint || DEFAULT_API_ENDPOINT;\n  try {\n    const origin = typeof window !== \"undefined\" ? window.location.origin : \"\";\n    const res = await fetch(\n      `${endpoint}?appId=${appId}&origin=${encodeURIComponent(origin)}`,\n    );\n    if (!res.ok) {\n      return { status: \"MAINTENANCE\", message: \"Server error\" };\n    }\n    const data: ValidationResponse = await res.json();\n    return data;\n  } catch (err) {\n    console.error(\"App validation failed\", err);\n    return { status: \"MAINTENANCE\", message: \"Network error\" };\n  }\n}\n","import * as cookie from \"cookie\";\n\nexport function setValidationCookie(name: string, value: string, hours = 24) {\n  const expires = new Date();\n  expires.setHours(expires.getHours() + hours);\n\n  document.cookie = cookie.serialize(name, value, {\n    path: \"/\",\n    expires,\n    sameSite: \"lax\",\n    secure:\n      typeof window !== \"undefined\" && window.location.protocol === \"https:\",\n  });\n}\n\nexport function getValidationCookie(name: string): string | null {\n  if (typeof document === \"undefined\") return null;\n\n  const cookies = cookie.parse(document.cookie || \"\");\n  return cookies[name] || null;\n}\n\nexport function deleteValidationCookie(name: string) {\n  document.cookie = cookie.serialize(name, \"\", {\n    path: \"/\",\n    expires: new Date(0),\n  });\n}\n","\"use client\";\nimport Maintenance from \"./Maintenance\";\nimport { useEffect, useState } from \"react\";\nimport { validateApp, ValidationResponse } from \"./utils/api\";\nimport { setValidationCookie, getValidationCookie } from \"./utils/cookies\";\n\ninterface AppValidatorProps {\n  appId: string;\n  appName?: string;\n  apiEndpoint?: string; // optional API endpoint\n  children: React.ReactNode;\n}\n\nexport default function AppValidator({\n  appId,\n  appName,\n  apiEndpoint,\n  children,\n}: AppValidatorProps) {\n  const [status, setStatus] = useState<\"LOADING\" | \"OK\" | \"MAINTENANCE\">(\n    \"LOADING\",\n  );\n  const [message, setMessage] = useState<string | undefined>();\n\n  const COOKIE_NAME = \"X-APP-V\";\n  const COOKIE_LIFETIME_HOURS = 24; // cookie expires in 24 hours\n\n  useEffect(() => {\n    async function checkApp() {\n      const cached = getValidationCookie(COOKIE_NAME);\n\n      if (cached === \"OK\") {\n        // Offline grace: cached OK cookie\n        setStatus(\"OK\");\n        return;\n      }\n\n      // Make API call to validate appId\n      const res: ValidationResponse = await validateApp(appId, apiEndpoint);\n\n      if (res.status === \"OK\") {\n        setStatus(\"OK\");\n        setMessage(undefined);\n        // Set cookie for 24 hours\n        setValidationCookie(COOKIE_NAME, \"OK\", COOKIE_LIFETIME_HOURS);\n      } else {\n        if (cached === \"OK\") {\n          // Offline grace: previously cached OK\n          setStatus(\"OK\");\n          setMessage(\"Offline grace period active\");\n        } else {\n          setStatus(\"MAINTENANCE\");\n          setMessage(res.message);\n          setValidationCookie(\n            COOKIE_NAME,\n            \"MAINTENANCE\",\n            COOKIE_LIFETIME_HOURS,\n          );\n        }\n      }\n    }\n\n    checkApp();\n  }, [appId, apiEndpoint]);\n\n  if (status === \"LOADING\") return <div>Loading...</div>;\n  if (status === \"MAINTENANCE\")\n    return <Maintenance appName={appName} message={message} />;\n  return <>{children}</>;\n}\n"]}